<!DOCTYPE HTML>
<html>
<head>
    <title>Cubeia Poker</title>

    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="images/lobby/icon.png" />

    <link rel="stylesheet" type="text/css" href="css/CircularProgressBar.css"/>
    <!-- All less files is imported in this base.less-->
    <link rel="stylesheet" type="text/css" href="lcss/base.css"">

    <script type="text/javascript"  src="js/lib/less-1.3.0.min.js"></script>

    <script type="text/javascript" src="js/lib/classjs.js"></script>
    <script type="text/javascript" src="js/lib/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="js/lib/jquery-ui-1.8.21.custom.min.js"></script>
    <script type="text/javascript" src="js/lib/jquery.ui.touch-punch.js"></script>

    <script type="text/javascript" src="js/lib/mustache.js"></script>
    <script type="text/javascript" src="js/lib/jquery.jqGrid.min.js"></script>
    <script type="text/javascript" src="js/lib/json2.js"></script>


    <script type="text/javascript" src="js/lib/facebox/facebox.js"></script>
    <script type="text/javascript">
        $.facebox.settings.closeImage = 'images/global/close.png';
        $.facebox.settings.loadingImage = 'images/global/close.png';
    </script>

    <script type="text/javascript" src="js/base/ui/CircularProgressBar.js"></script>

    <script src="js/lib/cubeia/firebase-js-api-1.8.0-CE-javascript.js" type="text/javascript"></script>
    <script src="js/lib/cubeia/firebase-protocol-1.8.0-CE-javascript.js" type="text/javascript"></script>
    <script src="js/lib/poker-protocol-1.0-SNAPSHOT.js" type="text/javascript"></script>

    <script src="js/base/Utils.js" type="text/javascript"></script>

    <script type="text/javascript" src="js/base/MyPlayer.js"></script>
    <script type="text/javascript" src="js/base/PlayerTableStatus.js"></script>

    <script src="js/base/communication/ProtocolHandler.js" type="text/javascript"></script>
    <script src="js/base/communication/AbstractConnectorHandler.js" type="text/javascript"></script>
    <script src="js/base/communication/TableComHandler.js" type="text/javascript"></script>
    <script src="js/base/communication/CommunicationHandler.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/base/data/Map.js"></script>
    <script type="text/javascript" src="js/base/ui/BetSlider.js"></script>
    <script type="text/javascript" src="js/base/Action.js"></script>
    <script type="text/javascript" src="js/base/ui/MyActionsManager.js"></script>
    <script type="text/javascript" src="js/base/ui/LobbyLayoutManager.js"></script>
    <script type="text/javascript" src="js/base/listeners/TableListener.js"></script>
    <script type="text/javascript" src="js/base/Player.js"></script>
    <script type="text/javascript" src="js/base/PlayerManager.js"></script>
    <script type="text/javascript" src="js/base/Table.js"></script>
    <script type="text/javascript" src="js/base/TableManager.js"></script>
    <script type="text/javascript" src="js/base/ui/TableLayoutManager.js"></script>
    <script type="text/javascript" src="js/base/ui/TemplateManager.js"></script>
    <script type="text/javascript" src="js/base/ui/Seat.js"></script>
    <script type="text/javascript" src="js/base/ui/MyPlayerSeat.js"></script>
    <script type="text/javascript" src="js/base/ui/Card.js"></script>
    <script type="text/javascript" src="js/base/ui/CommunityCard.js"></script>
    <script type="text/javascript" src="js/base/Pot.js"></script>
    <script type="text/javascript" src="js/base/Hand.js"></script>
    <script type="text/javascript" src="js/base/ui/describe.js"></script>
    <script type="text/javascript" src="js/base/ui/CSSAnimator.js"></script>
    <script type="text/javascript" src="js/base/ui/AnimationManager.js"></script>
    <script type="text/javascript" src="js/base/ui/DealerButton.js"></script>
    <script type="text/javascript" src="js/base/sound/SoundManager.js"></script>
    <script type="text/javascript" src="js/base/sound/SoundRepository.js"></script>
    <script type="text/javascript" src="js/base/sound/Sounds.js"></script>

    <script type="text/javascript" src="js/base/ui/DialogManager.js"></script>
    <script type="text/javascript" src="js/base/ui/BuyInDialog.js"></script>

    <script type="text/javascript">
        var comHandler = null;
        var soundRepository = new Poker.SoundRepository();
        var dialogManager = null;
        function handleKeyUp(keyCode) {
            if(keyCode == 13) {
                $("#loginButton").click();
            }
        }
        var isIphone = false;
        $(document).ready(function(){

            dialogManager = new Poker.DialogManager();

            $(".describe").describe();

            $("body").bind("touchmove", function(e){
                var target = !$(e.target);
                if(comHandler.isInTableView() && (target.hasClass("ui-slider-handle") || dialogManager.open == true)) {
                   e.preventDefault();
                }
            });
            var requestHost = window.location.hostname;
            var webSocketUrl = requestHost ? requestHost : "localhost";
            var webSocketPort = 9191;

            console.log("connecting to WS: " + webSocketUrl + ":" + webSocketPort);

            var tableComManager = null;
            //handles the lobby UI

            //wraps Firebase communication
            comHandler = new Poker.CommunicationHandler(webSocketUrl, webSocketPort);

            $("#loginButton").click(function(e){
                console.log("logging in");
                if ($('#user').val() != "username" && $('#pwd').val() != "Password") {
                    var usr = $('#user').val();
                    var pwd = $('#pwd').val();
                    comHandler.doLogin(usr,pwd);

                }
            });
            $("#user").keyup(function(e){
               handleKeyUp(e.keyCode);
            });
            $("#pwd").keyup(function(e){
                handleKeyUp(e.keyCode);
            });


            setPokerSize();

        });
        var tableView = null;
        var baseWidth = 1024;

        function setPokerSize(){
            if(window.matchMedia) {
                var mq1 = window.matchMedia("(max-width:700px)")
                var mq2 = window.matchMedia("(max-height: 400px)");
                if(mq1.matches || mq2.matches) {
                    isIphone = true;
                } else {
                    isIphone = false;
                }
            } else {
                isIphone = false;
            }

            var w = $(window);
            if(tableView==null) {
                tableView = $("#tableView");
            }
            //iphone - statusbar = 8/5
            var maxAspectRatio = 4/3;
            if(isIphone) {
                maxAspectRatio = 8/5;
            }

            if(w.width()/ w.height() > maxAspectRatio) {
                var width = w.height() * maxAspectRatio;
                tableView.css({
                    width: Math.round(width) +  "px",
                    height :Math.round(w.height())+"px",
                    marginLeft :Math.round((w.width()-width)/2)  + "px"
                });

                var targetFontSize =  Math.round(90* width / baseWidth);
                if(targetFontSize>130) {
                    targetFontSize=130;
                }
                $("body").css({fontSize : targetFontSize+"%"});
            } else {
                tableView.css({width:"100%",height:"100%", marginLeft : 0+"px"});
                var targetFontSize =  Math.round(90* w.width() / baseWidth);
                if(targetFontSize>130) {
                    targetFontSize=130;
                }
                $("body").css({fontSize : targetFontSize+"%"});
            }
        }

        $(window).resize(function(){
            setPokerSize();
        });

    </script>

</head>
<body>
    <div id="loginView" class="login-view">
        <div id="dialog1" class="login-dialog">
            <div class="logo-container"><img src="images/lobby/logo.png"/></div>
            <div class="login-container">
                <div class="login-input-container">
                    <input name="user" class="describe" id="user" type="text" title="Username" value="" />
                    <input name="pwd" class="describe" id="pwd" type="password" title="Password" value=""/>
                </div>
                <div id="loginButton" class="login-button">
                    <span>login</span>
                </div>
            </div>
            <div class="status-label">Status: <span class="connect-status"></span></div>
        </div>
    </div>

    <div id="lobbyView" class="lobby-container"  style="display:none;">
        <div id="lobby" class="lobby-list">

            <div class="left-column">
                <div class="logo-container">
                    <img src="images/lobby/logo.png"/>
                </div>
                <ul class="main-menu">
                    <li><a class="selected" id="cashGameMenu"  href="#table-list">Cash Games</a></li>
                    <li><a id="sitAndGoMenu" href="#table-list">Sit &amp; Go's</a></li>
                    <li><a  id="tournamentMenu" href="#table-list">Tournaments</a></li>
                </ul>
            </div>
            <div class="right-column">
                <div class="top-panel" id="table-list">
                    <div class="user-panel">
                        <span class="status">Logged in: </span><span id="username"></span> (<span id="userId"></span>)
                    </div>
                    <div class="show-filters">
                        <a>Show filters</a>
                    </div>
                    <div class="table-filter">
                        <div class="filter-group tables">
                            <div class="filter-label">Show tables:</div>
                            <div class="filter-button" id="fullTables">Full</div>
                            <div class="filter-button" id="emptyTables">Empty</div>
                        </div>
                        <div class="filter-group limits">
                            <div class="filter-label">Show Limits:</div>
                            <div class="filter-button" id="noLimit">NL</div>
                            <div class="filter-button" id="potLimit">PL</div>
                            <div class="filter-button" id="fixedLimit">FL</div>
                        </div>
                        <div class="filter-group stakes">
                            <div class="filter-label">Stakes:</div>
                            <div class="filter-button" id="lowStakes">Low</div>
                            <div class="filter-button" id="mediumStakes">Mid</div>
                            <div class="filter-button" id="highStakes">High</div>
                        </div>
                    </div>
                </div>
                <div class="lobby-tab">
                        <div id="tableListContainer">
                            <div class="table-item-header">
                                <div class="table-name">name</div>
                                <div class="seated">seated</div>
                                <div class="blinds">blinds</div>
                                <div class="type">type</div>
                                <div class="play"></div>
                            </div>

                            <div id="tableListItemContainer">

                            </div>
                        </div>
                    </div>
                </div>

        </div>

    </div>

    <div id="tableView" style="display:none;" class="table-container">
        <div class="table-logo"></div>
        <div id="seatContainer" class="default-table table-10">
            <div class="seat" id="seat0">

            </div>
            <div class="seat" id="seat1">

            </div>
            <div class="seat" id="seat2">

            </div>
            <div class="seat" id="seat3">

            </div>
            <div class="seat" id="seat4">

            </div>
            <div class="seat" id="seat5">

            </div>
            <div class="seat" id="seat6">

            </div>
            <div class="seat" id="seat7">

            </div>
            <div class="seat" id="seat8">

            </div>
            <div class="seat" id="seat9">

            </div>
            <div class="my-player-seat" id="myPlayerSeat">

            </div>
            <div id="communityCards" class="community-cards">

            </div>
            <div id="mainPotContainer" class="main-pot">

            </div>
            <div id="dealerButton" class="dealer-button" style="display:none;">
               <img src="images/table/dealer-button.svg"/>
            </div>
        </div>
        <div id="myPlayerContainer" class="bottom-bar">
            <div class="action-button" id="actionSitOut" style="display: none;">
                <span>Sit-out</span>
            </div>
            <div class="own-player" id="myPlayer" style="display:none;">
                <div class="name" id="myPlayerName"></div>
                <div class="balance" id="myPlayerBalance"></div>
            </div>

            <div id="userActActions" class="user-actions">
                <div class="action-button" id="actionFold" style="display: none;">
                    <span>Fold</span>
                </div>
                <div class="action-button" id="actionCall" style="display: none;">
                    <span class="amount"></span>
                    <span>Call</span>
                </div>
                <div class="action-button" id="actionCheck" style="display: none;">
                    <span>Check</span>
                </div>
                <div class="action-button" id="actionRaise" style="display: none;">
                    <span class="amount"></span>
                    <span>Raise</span>
                </div>
                <div class="action-button" id="actionBet" style="display: none;">
                    <span class="amount"></span>
                    <span>Bet</span>
                </div>
                <div class="action-button" id="actionCancelBet" style="display:none;">
                    <span>Cancel</span>
                </div>
                <div class="action-button" id="doActionBet" style="display:none;">
                    <span class="slider-value amount"></span>
                    <span>Bet</span>
                </div>
                <div class="action-button" id="doActionRaise" style="display:none;">
                    <span class="slider-value amount"></span>
                    <span>Raise</span>
                </div>
                <div class="action-button" id="actionJoin" style="display: none;">
                    <span>Join</span>
                </div>
                <div class="action-button" id="actionLeave" style="display: none;">
                    <span>Leave</span>
                </div>
                <div class="action-button" id="actionSitIn" style="display: none;">
                    <span>Sit-in</span>
                </div>

            </div>
        </div>
        <div id="circularProgressBar" class="circular-progress-bar">

        </div>

    </div>

    <div id="emptySeatTemplate" style="display: none;">
        <div class="avatar-base">
            <div class="open-seat">Open Seat</div>
        </div>
    </div>
    <div id="seatTemplate" style="display: none;">

        <div class="avatar-base">
            <div class="progress-bar">

            </div>
        </div>
        <div class="player-name">
            {{name}}
        </div>
        <div class="avatar">

        </div>
        <div class="cards-container cards-container-player">

        </div>

        <div class="player-status">
            Sitting out
        </div>
        <div class="seat-balance balance">

        </div>
        <div class="action-text">
            Small Blind
        </div>
        <div class="action-amount balance">

        </div>
        <div class="hand-strength">

        </div>

    </div>
    <script type="text/mustache" id="playerCardTemplate" style="display: none;">
        <div id="playerCard-{{domId}}" class="player-card-container">
            <img src="images/cards/{{cardString}}.svg" class="player-card"/>
        </div>
    </script>
    <script type="text/mustache" id="communityCardTemplate" style="display: none;">
        <div id="communityCard-{{domId}}" class="community-card-container">
            <img src="images/cards/{{cardString}}.svg" class="player-card"/>
        </div>
    </script>
    <div id="mainPotTemplate" style="display: none;">
        <span>Pot:</span> <div class="balance">&euro;{{amount}}</div>
    </div>
    <div id="myPlayerSeatTemplate" style="display:none;">
        <div class="action-amount balance">

        </div>
        <div class="cards-container">

        </div>
        <div class="action-text">

        </div>
        <div class="hand-strength">

        </div>
    </div>

    <div id="tableListItemTemplate" style="display: none;">
        <div class="table-item  {{tableStatus}}" id="tableItem{{id}}">
            <div class="table-name">{{name}}</div>
            <div class="seated">{{seated}}/{{capacity}}</div>
            <div class="blinds">{{blinds}}</div>
            <div class="type">{{type}}</div>
            <div class="play-text">&raquo;</div>
            <div class="full-text">Full</div>
        </div>
    </div>
    <div id="potTransferTemplate" style="display: none;">
        <div id="potTransfer{{id}}" class="pot-transfer" style="visibility: hidden;">
            <div class="balance">&euro;{{amount}}</div>
        </div>
    </div>

    <div id="buyinDialog" style="display: none;">
        <h1>Buy-in at table <span class="buyin-table-name">Table</span></h1>
        <div class="buy-in-row">
            <span class="desc">Your balance:</span>  <span class="balance buyin-balance">&euro;1023.00</span>
        </div>
        <div class="buy-in-row">
            <span class="desc">Max amount:</span>  <span class="balance buyin-max-amount">&euro;1023.00</span>
        </div>
        <div class="buy-in-row">
            <span class="desc">Min amount:</span>  <span class="balance buyin-min-amount">&euro;1023.00</span>
        </div>
        <div class="buy-in-row">
            <span class="desc">Buy-in amount:</span> <input type="text" class="buyin-amount dialog-input" value="" />
        </div>
        <div class="buy-in-row">
            <span class="buyin-error" style="display: none;"></span>
        </div>


        <p class="dialog-buttons">
            <a href="#" class="dialog-cancel-button">
                Cancel
            </a>
            <a href="#" class="dialog-ok-button">
                Buy in
            </a>
        </p>

    </div>
    <div id="genericDialog" style="display: none;">
        <h1>Header</h1>
        <p class="message">Message</p>
        <p class="dialog-buttons">
            <a href="#" class="dialog-ok-button">
                Continue
            </a>
        </p>

    </div>

</body>
</html>